---
driver_plugin: vagrant
driver_config:
  require_chef_omnibus: true

platforms:
- name: ubuntu-12.04
  run_list:
  - recipe[apt::default]
  driver_config:
    box: opscode-ubuntu-12.04
    box_url: https://opscode-vm-bento.s3.amazonaws.com/vagrant/opscode_ubuntu-12.04_provisionerless.box
    customize:
      cpus: 2
      memory: 512
- name: centos-6.4
  run_list:
  - recipe[yum::epel]
  driver_config:
    box: opscode-centos-6.4
    box_url: https://opscode-vm-bento.s3.amazonaws.com/vagrant/opscode_centos-6.4_provisionerless.box
    customize:
      cpus: 2
      memory: 512

suites:
- name: default
  run_list:
  - recipe[rs-mysql::default]
  - recipe[rs-mysql::collectd]
  - recipe[fake::database_mysql]
  attributes:
    cloud:
      provider: 'vagrant'
      public_ips: ['10.10.1.1']
      private_ips: ['10.0.2.15']
    rs-mysql:
      backup:
        lineage: 'lineage'
      server_root_password: rootpass
      server_repl_password: realpass
      server_usage: dedicated
      application_username: appuser
      application_password: apppass
      application_database_name: app_test
    rightscale:
      instance_uuid: '1111111'

- name: dump_import
  run_list:
  - recipe[rs-mysql::default]
  - recipe[rs-mysql::dump_import]
  attributes:
    cloud:
      provider: 'vagrant'
      public_ips: ['10.10.1.1']
      private_ips: ['10.0.2.15']
    rs-mysql:
      backup:
        lineage: 'lineage'
      server_root_password: rootpass
      server_repl_password: realpass
      server_usage: dedicated
      import:
        repository: https://github.com/rightscale/examples.git
        revision: unified_php
        dump_file: app_test.sql.bz2
    rightscale:
      instance_uuid: '1111111'

- name: shared_server
  run_list:
  - recipe[rs-mysql::default]
  - recipe[fake::database_mysql]
  attributes:
    cloud:
      provider: 'vagrant'
      public_ips: ['10.10.1.1']
      private_ips: ['10.0.2.15']
    rs-mysql:
      backup:
        lineage: 'lineage'
      server_root_password: rootpass
      server_repl_password: replpass
      server_usage: shared
      application_database_name: app_test


- name: master
  run_list:
  - recipe[rs-mysql::master]
  provisioner:
      solo_rb:
        log_location: /var/log/chef-solo.log
  attributes:
    cloud:
      provider: 'vagrant'
      public_ips: ['10.10.1.1']
      private_ips: ['10.0.2.15']
    rs-mysql:
      backup:
        lineage: 'lineage'
      server_root_password: rootpass
      server_repl_password: replpass
      server_usage: dedicated
    rightscale:
      instance_uuid: '1111111'

- name: slave
  run_list:
  - recipe[fake::master]
  - recipe[rs-mysql::slave]
  provisioner:
      solo_rb:
        log_location: /var/log/chef-solo.log
  attributes:
    cloud:
      provider: 'vagrant'
      public_ips: ['10.10.2.2']
      private_ips: ['10.0.2.15']
    rs-mysql:
      backup:
        lineage: 'lineage'
      server_root_password: rootpass
      server_repl_password: replpass
      server_usage: dedicated
      slave_functional_timeout: -1
    rightscale:
      instance_uuid: '2222222'
